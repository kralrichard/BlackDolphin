<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Black Dolphine – Mafia Oyunu</title>
  <style>
    :root {
      --bg-dark: #121212;
      --bg-light: #f4f4f4;
      --panel-dark: #1e1e1e;
      --accent-vakur: #1e90ff;   /* Mavi */
      --accent-hatip: #ffa500;   /* Turuncu */
      --accent-baron: #ff4500;   /* Kırmızı */
      --text-light: #f4f4f4;
      --text-dark: #333;
      --bar-bg: #ccc;
    }
    * {
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:'Segoe UI',sans-serif;
    }
    html, body {
      height:100%;
    }
    body {
      display:flex;
      overflow:hidden;
      background:var(--bg-light);
      color:var(--text-dark);
    }

    /* SIDEBAR */
    nav {
      width:220px;
      background:var(--panel-dark);
      color:var(--text-light);
      display:flex;
      flex-direction:column;
    }
    nav ul {
      list-style:none;
      overflow-y:auto;
      flex:1;
    }
    nav li a {
      display:block;
      padding:12px 20px;
      color:inherit;
      text-decoration:none;
      border-bottom:1px solid #333;
      transition: background 0.2s;
    }
    nav li a:hover,
    nav li a.active {
      background:var(--accent-vakur);
    }
    nav .locked {
      opacity:0.5;
      pointer-events:none;
    }
    nav .search {
      padding:10px;
    }
    nav .search input {
      width:100%;
      padding:8px;
      border:none;
      border-radius:4px;
    }

    /* Durumum kahverengi */
    .navDurum {
      background: brown !important;
      color: #fff !important;
    }
    /* Vakur - mavi, Hatip - turuncu, Baron - kırmızı */
    .navVakur {
      background: var(--accent-vakur) !important;
      color: #fff !important;
    }
    .navHatip {
      background: var(--accent-hatip) !important;
      color: #fff !important;
    }
    .navBaron {
      background: var(--accent-baron) !important;
      color: #fff !important;
    }

    /* MAIN */
    main {
      flex:1;
      display:flex;
      flex-direction:column;
      overflow-y:auto;
    }
    header {
      background:var(--bg-dark);
      color:var(--text-light);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:0.5rem 1rem;
      flex-shrink:0;
    }
    .logo {
      font-size:1.4rem;
      font-weight:bold;
    }
    .balance {
      background:#222;
      padding:0.5rem 1rem;
      border-radius:4px;
      color:lime;
    }

    /* 4 RAILS */
    .rail-container {
      position:relative;
      margin:1rem 0;
      flex-shrink:0;
    }
    .rail-label {
      position:absolute;
      top:-1.2rem;
      left:1rem;
      color:var(--text-dark);
      font-weight:bold;
    }
    .stations {
      display:flex;
      padding:0 1rem;
      margin-bottom:4px;
      flex-wrap:wrap;
    }
    .stations span {
      flex:1;
      text-align:center;
      font-size:0.75rem;
      color:var(--text-dark);
      cursor:pointer;
      margin:2px 0;
    }
    .stations span.visited {
      color:var(--accent-vakur);
      font-weight:bold;
    }
    canvas.rail {
      width:100%;
      height:60px;
      cursor:pointer;
    }

    /* CENTER RANKS */
    #centerRanks {
      display:flex;
      justify-content:center;
      gap:2rem;
      padding:1rem;
      flex-shrink:0;
      flex-wrap: nowrap;
    }
    .card {
      background:var(--panel-dark);
      color:var(--text-light);
      padding:1rem;
      border-radius:8px;
      text-align:center;
      width:120px;
      cursor:pointer;
    }
    .card.locked {
      opacity:0.5;
      pointer-events:none;
    }
    .card h2 {
      margin-bottom:0.5rem;
      text-transform:uppercase;
    }
    .card button {
      border:none;
      color:#fff;
      padding:0.5rem 1rem;
      border-radius:4px;
      cursor:pointer;
    }
    .card.vakur {
      background:var(--accent-vakur);
    }
    .card.hatip {
      background:var(--accent-hatip);
    }
    .card.baron {
      background:var(--accent-baron);
    }

    /* OVERLAY / TASKS */
    #overlay {
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.7);
      display:none;
      align-items:center;
      justify-content:center;
    }
    #panel {
      background:var(--bg-light);
      width:90%;
      max-width:600px;
      max-height:80%;
      overflow-y:auto;
      border-radius:8px;
      padding:1rem;
      position:relative;
    }
    #closeBtn {
      position:absolute;
      top:0.5rem;
      right:0.5rem;
      background:var(--accent-vakur);
      border:none;
      color:#fff;
      padding:0.3rem 0.6rem;
      border-radius:4px;
      cursor:pointer;
    }
    .rankSection {
      margin-bottom:1rem;
    }
    .rankSection h3 {
      margin-bottom:0.5rem;
      color:var(--accent-vakur);
    }
    .taskItem {
      background:var(--bar-bg);
      padding:0.5rem;
      display:flex;
      justify-content:space-between;
      border-radius:4px;
      margin-bottom:0.3rem;
      align-items:center;
    }
    .taskItem.done {
      background:#a8e6cf;
    }
    .taskItem button {
      border:none;
      color:#fff;
      padding:0.3rem 0.6rem;
      border-radius:4px;
      cursor:pointer;
      background:var(--accent-vakur);
    }

    /* STATUS BARS */
    .status-bar {
      margin-bottom:1rem;
    }
    .status-bar .label {
      display:flex;
      align-items:center;
      gap:0.5rem;
      margin-bottom:0.3rem;
      font-weight:bold;
    }
    .status-bar .bar {
      background:var(--bar-bg);
      height:16px;
      border-radius:8px;
      overflow:hidden;
    }
    .status-bar .bar .fill {
      height:100%;
      width:0;
    }
    .vakur-fill  { background:gold; }
    .vakur-ros   { background:blue; }
    .hatip-fill  { background:purple; }
    .hatip-ros   { background:orange; }
    .baron-fill  { background:white; }
    .baron-ros   { background:red; }

    /* PANELS */
    aside {
      width:260px;
      background:var(--panel-dark);
      color:var(--text-light);
      overflow-y:auto;
      flex-shrink:0;
    }
    .panel {
      padding:20px;
      border-bottom:1px solid #333;
      display:none;
    }
    .panel.active {
      display:block;
    }
    .panel h3 {
      margin-bottom:10px;
      color:var(--accent-vakur);
    }
    .sub-tabs {
      display:flex;
      gap:8px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .sub-tabs button {
      background:#444;
      border:none;
      color:var(--text-light);
      padding:6px 10px;
      border-radius:4px;
      cursor:pointer;
    }
    .sub-tabs button.active {
      background:var(--accent-vakur);
    }
    .sub-content ul {
      list-style:none;
      max-height:200px;
      overflow-y:auto;
      padding-left:0;
    }
    .sub-content li {
      display:flex;
      justify-content:space-between;
      margin-bottom:6px;
    }
    .sub-content li button {
      background:var(--accent-vakur);
      border:none;
      color:#fff;
      padding:4px 8px;
      border-radius:4px;
      cursor:pointer;
    }
    table {
      border-collapse:collapse;
    }

    /* CHAT */
    #chatBox {
      position:fixed;
      bottom:20px; left:50%;
      transform:translateX(-50%);
      width:60%;
      background:var(--panel-dark);
      color:var(--text-light);
      padding:10px;
      border-radius:8px;
      max-height:200px;
      overflow-y:auto;
    }
    #messageIcon {
      position:fixed;
      bottom:20px;
      right:20px;
      background:var(--accent-vakur);
      padding:10px;
      border-radius:50%;
      color:#fff;
      cursor:pointer;
    }

    /* MOBILE */
    @media (max-width: 768px) {
      nav, aside {
        width:100%;
        order:2;
      }
      nav ul {
        display:flex;
        flex-wrap:wrap;
        overflow-x:auto;
      }
      main {
        order:1;
      }
      header {
        justify-content:center;
      }
      #centerRanks {
        flex-wrap:wrap;
        gap:1rem;
        justify-content:center;
      }
      .panel {
        padding:10px;
      }
      .stations span {
        font-size:0.65rem;
      }
      #chatBox {
        width:90%;
        bottom:10px;
      }
      #messageIcon {
        bottom:10px;
        right:10px;
      }
    }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <nav>
    <ul>
      <li><a href="#" class="navDurum active" onclick="togglePanel('durum')">Durumum</a></li>
      <li><a href="#" onclick="togglePanel('aile')">Ailem</a></li>
      <li><a href="#" onclick="togglePanel('davetEt')">Davet Et</a></li>
      <li><a href="#" onclick="togglePanel('tuccar')">Tüccar</a></li>
      <li><a href="#" onclick="togglePanel('mesajlar')">Mesajlarım</a></li>
      <li><a href="#" onclick="togglePanel('avlan')">Avlan</a></li>
      <li><a href="#" onclick="togglePanel('acikArttirma')">Açık Arttırma</a></li>
      <li><a href="#" onclick="togglePanel('kacak')">Kaçakçılık</a></li>
      <!-- VAKUR (mavi), HATİP (turuncu, kilitli), BARON (kırmızı, kilitli) -->
      <li><a href="#" class="navVakur" onclick="openTasks('Vakur')">Vakur Görevleri</a></li>
      <li><a href="#" class="navHatip locked" onclick="openTasks('Hatip')">Hatip Görevleri</a></li>
      <li><a href="#" class="navBaron locked" onclick="openTasks('Baron')">Baron Görevleri</a></li>
      <li><a href="#" onclick="togglePanel('atYarisi')">At Yarışı</a></li>
      <li><a href="#" onclick="togglePanel('atBilgiler')">At Bilgileri</a></li>
      <li><a href="#" onclick="togglePanel('oyunIci')">Oyun İçi Bilgiler</a></li>
      <li><a href="#" onclick="togglePanel('aranan')">Arananlar</a></li>
      <li><a href="#" onclick="togglePanel('oyunlar')">Oyunlar</a></li>
      <li><a href="#" onclick="togglePanel('koy')">Köy İncelemesi</a></li>
      <li><a href="#" onclick="togglePanel('tren')">Tren Seyahatleri</a></li>
    </ul>
    <div class="search">
      <input type="text" placeholder="Kullanıcı ara...">
    </div>
  </nav>

  <!-- MAIN -->
  <main>
    <header>
      <div class="logo">BLACK DOLPHINE</div>
      <div class="balance" id="moneyDisplay">$500,000</div>
    </header>

    <!-- 4 Ray -->
    <div class="rail-container">
      <div class="rail-label">Gidiş Rotası I</div>
      <div class="stations" id="stationsOut1"></div>
      <canvas id="railOut1" class="rail"></canvas>
    </div>
    <div class="rail-container">
      <div class="rail-label">Gidiş Rotası II</div>
      <div class="stations" id="stationsOut2"></div>
      <canvas id="railOut2" class="rail"></canvas>
    </div>
    <div class="rail-container">
      <div class="rail-label return">Dönüş Rotası I</div>
      <div class="stations" id="stationsBack1"></div>
      <canvas id="railBack1" class="rail"></canvas>
    </div>
    <div class="rail-container">
      <div class="rail-label return">Dönüş Rotası II</div>
      <div class="stations" id="stationsBack2"></div>
      <canvas id="railBack2" class="rail"></canvas>
    </div>

    <!-- Center Ranks -->
    <div id="centerRanks">
      <div class="card vakur" id="cardVakur">
        <h2>VAKUR</h2>
        <button onclick="openTasks('Vakur')">Serüven</button>
      </div>
      <div class="card hatip locked" id="cardHatip">
        <h2>HATİP</h2>
        <button onclick="openTasks('Hatip')">Serüven</button>
      </div>
      <div class="card baron locked" id="cardBaron">
        <h2>BARON</h2>
        <button onclick="openTasks('Baron')">Serüven</button>
      </div>
    </div>
  </main>

  <!-- RIGHT PANEL -->
  <aside>
    <!-- Durum Paneli -->
    <div class="panel active" id="durumPanel">
      <h3>Durumum</h3>
      <!-- Vakur -->
      <div class="status-bar">
        <div class="label">🛡️ Vakur %<span id="vakurPct">0</span></div>
        <div class="bar"><div class="fill vakur-fill" id="vakurBar"></div></div>
      </div>
      <div class="status-bar">
        <div class="label">🏅 Vakur Rozet <span id="vakurRos">0</span></div>
        <div class="bar"><div class="fill vakur-ros" id="vakurRosBar"></div></div>
      </div>
      <!-- Hatip -->
      <div class="status-bar">
        <div class="label">🏘️ Hatip %<span id="hatipPct">0</span></div>
        <div class="bar"><div class="fill hatip-fill" id="hatipBar"></div></div>
      </div>
      <div class="status-bar">
        <div class="label">🏅 Hatip Rozet <span id="hatipRos">0</span></div>
        <div class="bar"><div class="fill hatip-ros" id="hatipRosBar"></div></div>
      </div>
      <!-- Baron -->
      <div class="status-bar">
        <div class="label">⚡️ Baron %<span id="baronPct">0</span></div>
        <div class="bar"><div class="fill baron-fill" id="baronBar"></div></div>
      </div>
      <div class="status-bar">
        <div class="label">🏅 Baron Rozet <span id="baronRos">0</span></div>
        <div class="bar"><div class="fill baron-ros" id="baronRosBar"></div></div>
      </div>
    </div>

    <!-- Davet Et Panel -->
    <div class="panel" id="davetEtPanel">
      <h3>Davet Et</h3>
      <p>Arkadaşlarını oyuna davet edebilir, birlikte güçlenebilirsiniz!</p>
    </div>

    <!-- Köy İncelemesi Panel -->
    <div class="panel" id="koyPanel">
      <h3>Köy İncelemesi</h3>
      <div class="sub-tabs" id="koyTabs"></div>
      <div id="koyContent"></div>
    </div>

    <!-- Tren Seyahatleri Panel -->
    <div class="panel" id="trenPanel">
      <h3>Tren Seyahatleri</h3>
      <div class="sub-tabs" id="trenTabs"></div>
      <div id="trenContent"></div>
    </div>

    <!-- Diğer Boş Paneller -->
    <div class="panel" id="ailePanel"><h3>Ailem</h3></div>
    <div class="panel" id="tuccarPanel"><h3>Tüccar</h3></div>
    <div class="panel" id="mesajlarPanel"><h3>Mesajlarım</h3></div>
    <div class="panel" id="avlanPanel"><h3>Avlan</h3></div>
    <div class="panel" id="acikArttirmaPanel"><h3>Açık Arttırma</h3></div>
    <div class="panel" id="kacakPanel"><h3>Kaçakçılık</h3></div>
    <div class="panel" id="atYarisiPanel"><h3>At Yarışı</h3></div>
    <div class="panel" id="atBilgilerPanel"><h3>At Bilgileri</h3></div>
    <div class="panel" id="oyunIciPanel"><h3>Oyun İçi Bilgiler</h3></div>
    <div class="panel" id="arananPanel"><h3>Arananlar</h3></div>
    <div class="panel" id="oyunlarPanel"><h3>Oyunlar</h3></div>
  </aside>

  <!-- TASK MODAL -->
  <div id="overlay" onclick="closeTasks()">
    <div id="panel" onclick="event.stopPropagation()">
      <button id="closeBtn" onclick="closeTasks()">✖</button>
      <h2 id="taskHeader"></h2>
      <div id="taskSections"></div>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chatBox" contenteditable="true">CHAT başlıyor...</div>
  <div id="messageIcon">📩</div>

  <script>
    /**************************************
     * GENEL DEĞİŞKENLER
     **************************************/
    let playerMoney = 500000;
    let globalCooldown = false; // 10sn bekleme

    // (Raylar, Tren, Köy İncelemesi kodları vs. 
    //  orijinal şekilde burada devam ediyor, 
    //  kısaltmamak istersen aynen ekle.)

    // Burada “Görev” kısmını gösteriyoruz:

    // 5 Seviye Vakur
    const vakurDifficulties = [
      {
        title: "ÇIRAK VAKUR I",
        locked:false,
        tasks: [
          "Bir çocuğun okul çantası almasına yardımcı ol.",
          "Mahalledeki yaşlı bir komşunun alışveriş poşetlerini taşı.",
          "Sokaktaki sahipsiz bir köpek için su ve mama koy.",
          "Arkadaşına ufak bir hediye vererek moralini yükselt.",
          "İşsiz bir tanıdığına CV hazırlama konusunda destek ol.",
          "Kütüphanede eski kitapları düzenlemeye gönüllü ol.",
          "Bir hayır kurumuna ufak bir bağış yap veya yardım topla.",
          "Otobüste yaşlı veya hamile birine yer ver.",
          "Mahalle parkında çöp toplama etkinliğine katıl.",
          "Arkadaşına küçük bir sürpriz parti düzenle."
        ]
      },
      {
        title: "USTA VAKUR II",
        locked:true,
        tasks: [
          "Aile içinde tartışan iki akrabayı barıştır.",
          "Mahallede yardım kermesi veya etkinlik organize et.",
          "Maddi durumu kötü bir öğrenciye burs ayarla.",
          "Bir STK’nın etkinliğinde aktif rol al.",
          "Bakımsız parkı onarmak için gönüllüler topla.",
          "Kan bağışı kampanyasına katkıda bulun.",
          "Bir arkadaşın için profesyonel yardım aracılığı yap.",
          "Zorbalığa uğrayan birine çevrimiçi destek bul.",
          "Engelliler için kamu binalarına erişim kolaylığı sağla.",
          "Sokak hayvanları için geçici barınak oluştur."
        ]
      },
      {
        title: "UZMAN VAKUR III",
        locked:true,
        tasks: [
          "Afet bölgesine yardım ekibi olarak katıl.",
          "Kronik bir sorun için belediyeyle görüşüp çözüm talep et.",
          "Zor durumdaki aileye iş veya barınma imkânı sağla.",
          "Hayvan barınağında kapsamlı bakım ve temizlik yap.",
          "Küs olan iki arkadaşın barışmasına aracılık et.",
          "Toplum dışlanmış birini etkinliklere dahil et.",
          "Küçük çaplı bağış kampanyası düzenle.",
          "Yerel hastanede gönüllü refakat programına katıl.",
          "Belediye ile iş birliği yaparak gençlik merkezi aç.",
          "Maddi sıkıntı yaşayan aileler için erzak paketi dağıtımı yap."
        ]
      },
      {
        title: "EFSANE VAKUR IV",
        locked:true,
        tasks: [
          "Büyük ölçekli yardım projesine liderlik et.",
          "Gençlere yönelik mentorluk programı başlat.",
          "Meslek edindirme kursu organize et.",
          "Toplumsal soruna belediye-STK ortaklığıyla çözüm üret.",
          "Gönüllü ekibi kurarak yaşlı bakımevlerini ziyaret et.",
          "Okullarda 'empati ve yardımseverlik' semineri düzenle.",
          "Sosyal medya kampanyasıyla yardım toplama etkinliği düzenle.",
          "Ücretsiz terapi/rehberlik günü organize et.",
          "Üniversite öğrencilerine staj imkânları sunan platform oluştur.",
          "Çevre koruma amaçlı ağaçlandırma kampanyası düzenle."
        ]
      },
      {
        title: "YÜCE VAKUR V",
        locked:true,
        tasks: [
          "Ulusal çapta sosyal sorumluluk projesi yürüt.",
          "Büyük bağış konseri/festival düzenle.",
          "Gönüllüleri bir araya getiren platform kur.",
          "Eğitim bursu fonu başlat.",
          "Aile içi şiddete koruma ve rehabilitasyon hizmeti oluştur.",
          "Yardım vakfı kurarak sürekli yardım yürüt.",
          "Uluslararası STK’lerle iş birliği yaparak yurt dışına yardım taşı.",
          "Yurt çapında geri dönüşüm projesi başlat.",
          "Dezavantajlı bölgeler için uzaktan eğitim altyapısı kur.",
          "Sağlık hizmetleri alamayan bölgelere mobil sağlık aracı gönder."
          // NOT: 11. “görev” yok artık. Mesajı biz alert ile vereceğiz.
        ]
      }
    ].map(d=>({
      ...d,
      tasks: d.tasks.map(t=>({
        text: t,
        state: "idle",
        timeLeft:0,
        interval:null
      }))
    }));

    // Hatip
    const hatipDifficulties = [
      {
        title:"ÇIRAK HATİP I",
        locked:false,
        tasks:["Hatip Görev Örneği 1","Hatip Görev Örneği 2"]
      }
      // ...
    ].map(d=>({
      ...d,
      tasks: d.tasks.map(t=>({
        text:t,
        state:"idle",
        timeLeft:0,
        interval:null
      }))
    }));

    // Baron
    const baronDifficulties = [
      {
        title:"ÇIRAK BARON I",
        locked:false,
        tasks:["Baron Görev Örneği 1","Baron Görev Örneği 2"]
      }
      // ...
    ].map(d=>({
      ...d,
      tasks: d.tasks.map(t=>({
        text:t,
        state:"idle",
        timeLeft:0,
        interval:null
      }))
    }));

    const difficultiesMap = {
      Vakur: vakurDifficulties,
      Hatip: hatipDifficulties,
      Baron: baronDifficulties
    };

    function openTasks(rank){
      document.getElementById('overlay').style.display='flex';
      document.getElementById('taskHeader').textContent = rank+" Görevleri";
      const cont = document.getElementById('taskSections');
      cont.innerHTML="";

      difficultiesMap[rank].forEach((dif, idx)=>{
        const section = document.createElement('div');
        section.className = 'rankSection';
        const h3 = document.createElement('h3');
        h3.textContent = dif.title + (dif.locked?" (Kilitli)":"");
        section.appendChild(h3);

        dif.tasks.forEach(tObj=>{
          const div = document.createElement('div');
          div.className = 'taskItem' + (tObj.state==="done" ? " done" : "");
          let btnText="Yap";
          if(dif.locked)          btnText="Kilitli";
          else if(tObj.state==="cdWait")      btnText="10sn bekleniyor...";
          else if(tObj.state==="inProgress")  btnText=formatTime(tObj.timeLeft);
          else if(tObj.state==="done")        btnText="Tamamlandı";

          div.innerHTML = `
            <span>${tObj.text}</span>
            <button>${btnText}</button>
          `;
          const btn = div.querySelector("button");
          if(dif.locked || tObj.state==="cdWait" || tObj.state==="inProgress" || tObj.state==="done"){
            btn.disabled = true;
          }
          btn.onclick=()=>startTask(rank, idx, tObj, btn);

          section.appendChild(div);
        });

        cont.appendChild(section);
      });
    }

    function closeTasks(){
      document.getElementById('overlay').style.display='none';
    }

    // Görev başlatma: 10sn -> 30dk
    function startTask(rank, difficultyIndex, taskObj, btn){
      if(globalCooldown){
        alert("Yeni bir göreve başlamak için 10sn beklemelisin!");
        return;
      }
      // 10sn global
      globalCooldown = true;
      taskObj.state="cdWait";
      taskObj.timeLeft=10;
      btn.textContent = "10sn bekleniyor...";
      btn.disabled = true;

      const cdInt = setInterval(()=>{
        taskObj.timeLeft--;
        if(taskObj.timeLeft<=0){
          clearInterval(cdInt);
          // 30dk
          taskObj.state="inProgress";
          taskObj.timeLeft=1800; // 30*60
          updateTaskButton(btn, taskObj, rank, difficultyIndex);

          taskObj.interval = setInterval(()=>{
            taskObj.timeLeft--;
            if(taskObj.timeLeft<=0){
              clearInterval(taskObj.interval);
              taskObj.state="done";
              updateTaskButton(btn, taskObj, rank, difficultyIndex);
            } else {
              updateTaskButton(btn, taskObj, rank, difficultyIndex);
            }
          },1000);

          globalCooldown=false;
        } else {
          btn.textContent = taskObj.timeLeft + "sn bekleniyor...";
        }
      },1000);
    }

    function updateTaskButton(btn, taskObj, rank, difficultyIndex){
      if(taskObj.state==="inProgress"){
        btn.textContent = formatTime(taskObj.timeLeft);
      } else if(taskObj.state==="done"){
        btn.textContent="Tamamlandı";
        btn.parentElement.classList.add("done");

        // Son görevi bitirdik => kilit açma kontrolü
        checkDifficultyCompletion(rank);
        // Modal'ı da güncelleyebiliriz ki kilit kalkınca gözüksün
        openTasks(rank);
      }
    }

    function checkDifficultyCompletion(rank){
      const arr = difficultiesMap[rank];
      for(let i=0;i<arr.length;i++){
        const d = arr[i];
        const allDone = d.tasks.every(t=>t.state==="done");
        if(allDone){
          // Bir sonraki seviye varsa kilidini aç
          if(i < arr.length-1){
            arr[i+1].locked=false;
          }
        }
      }
      // Bütün seviye bitti mi?
      const allLevelsDone = arr.every(d => d.tasks.every(t=>t.state==="done"));
      if(allLevelsDone){
        if(rank==="Vakur"){
          // Hatip kilidini aç
          document.querySelector(".navHatip").classList.remove("locked");
          document.getElementById("cardHatip").classList.remove("locked");

          // Yüce Vakur bitti => mesaj
          alert("Tebrikler! Vakur görevlerini tamamladınız. Hatip görevlerine geçebilirsiniz! Şimdi ana menüye dönüyorsunuz.");
        }
        // istersen Hatip bitince Baron açma
      }
    }

    function formatTime(sec){
      let m = Math.floor(sec/60);
      let s = sec%60;
      return (m<10?"0"+m:m)+":"+(s<10?"0"+s:s);
    }

    // Tüm ray vs. kodu (travelTo, drawAllRails, initTrainTabs, initKoyTabs) 
    // ve panel toggle, paramoney vb. 
    // yukarıda/normal şekilde eklenmelidir.

  </script>
</body>
</html>
