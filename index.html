<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Black Dolphine - Mafia Oyunu</title>
  <style>
    /* (Stil kısmı aynı kalıyor) */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(120deg, #272727 0%, #111 50%, #000 100%);
      color: #f1f1f1;
      min-height: 100vh;
      position: relative;
      padding-top: 120px;
    }
    /* ... diğer stil kuralları ... */
  </style>
</head>
<body>
  <!-- STAT BARLARI ve Profil -->
  <div id="statBars">
    <div class="stat-bar" id="vakurStat">
      <div class="stat-label">Vakur 🛡️</div>
      <div class="stat-fill" id="vakurFill"></div>
      <!-- Vakur statına rozet sayısı eklendi -->
      <div class="stat-text" id="vakurText">Koruma: 0 (0%) | Rozet: 0</div>
    </div>
    <div class="stat-bar lockedStat" id="hatipStat">
      <div class="stat-label">Hatip 👥</div>
      <div class="stat-fill" id="hatipFill"></div>
      <!-- Hatip statına nüfus bilgisi ve rozet sayısı eklendi -->
      <div class="stat-text" id="hatipText">Nüfus: 0 (0%) | Rozet: 0</div>
    </div>
    <div class="stat-bar lockedStat" id="baronStat">
      <div class="stat-label">Baron ♛</div>
      <div class="stat-fill" id="baronFill"></div>
      <!-- Baron statına rozet sayısı eklendi -->
      <div class="stat-text" id="baronText">Etki: 0 (0%) | Rozet: 0</div>
    </div>
    <div id="profileInfo">Köy: <span id="currentVillageDisplay">Asman</span></div>
  </div>

  <!-- (Diğer HTML bölümleri aynı kalıyor: Village Travel, Header, Main içerik, Modaller vs.) -->
  
  <script>
    /* ------------------------
       1. GÖREV DİZİLERİ: Her rütbe için 5 kademede (her biri 8 görev – toplam 40)
       (Görevler ve tierOrder aynı kalıyor)
    ------------------------ */
    const tierOrder = ["basit", "orta", "zor", "ileri", "son"];
    const tasks = {
      vakur: {
        basit: [
          "Bir çocuğun okul çantası almasına yardımcı ol.",
          "Mahalledeki yaşlı bir komşunun alışveriş poşetlerini taşı.",
          "Sokaktaki sahipsiz bir köpek için su ve mama koy.",
          "Arkadaşına ufak bir hediye vererek moralini yükselt.",
          "İşsiz bir tanıdığına CV hazırlama konusunda destek ol.",
          "Kütüphanede eski kitapları düzenlemeye gönüllü ol.",
          "Bir hayır kurumuna ufak bir bağış yap veya yardım topla.",
          "Otobüste yaşlı veya hamile birine yer ver."
        ],
        /* Diğer kademeler... */
        orta: [/* ... */],
        zor: [/* ... */],
        ileri: [/* ... */],
        son: [
          "Ulusal çapta sosyal sorumluluk projesi yürüt.",
          "Büyük bağış konseri/festival düzenle.",
          "Gönüllüleri bir araya getiren platform kur.",
          "Eğitim bursu fonu başlat.",
          "Aile içi şiddete koruma ve rehabilitasyon hizmeti oluştur.",
          "Yardım vakfı kurarak sürekli yardım yürüt.",
          "Uluslararası STK’lerle iş birliği yaparak yurt dışına yardım taşı.",
          "Tebrikler, hatip oldunuz! Ana menüye dönüyorsunuz."
        ]
      },
      hatip: { /* Görev dizileri aynı */ },
      baron: { /* Görev dizileri aynı */ }
    };

    /* ------------------------
       2. GLOBAL DEĞİŞKENLER & RÜTBE KİLİT DURUMLARI
    ------------------------ */
    let currentRank = "Vakur";  // Başlangıçta yalnızca Vakur aktif
    let vakurTaskCount = 0, hatipTaskCount = 0, baronTaskCount = 0;
    let isHatipUnlocked = false, isBaronUnlocked = false;
    let blueBadgeCount = 0, orangeBadgeCount = 0, redBadgeCount = 0;
    let money = 500000;
    let onur = 0; // Hatip onur değeri

    // Stat hesapları:
    function getVakurKoruma() {
      let koruma = Math.floor(vakurTaskCount / 22);
      return (koruma % 661 === 0 && koruma > 0) ? 660 : koruma % 661;
    }
    function getHatipNufus() {
      let nufus = Math.floor(hatipTaskCount / 40) * 5;
      return (nufus % 201 === 0 && nufus > 0) ? 200 : nufus % 201;
    }
    function getBaronEtki() {
      let etki = Math.floor(baronTaskCount * 2);
      return (etki % 501 === 0 && etki > 0) ? 500 : etki % 501;
    }

    // Village Travel: 6 köy, ilk başta "Asman"
    const villages = ["Asman", "Mizrin", "Qeruk", "Shuman", "Alizera", "Bubuk"];
    let currentVillage = "Asman";

    /* ------------------------
       3. FONKSİYONLAR
    ------------------------ */

    // Stat Barlarını Güncelle (Rozet sayıları stat barlara eklenerek güncellendi)
    function updateStatBars() {
      // Vakur Barı
      let vakurValue = getVakurKoruma();
      let vakurYuzde = (vakurValue / 660) * 100;
      document.getElementById('vakurText').innerText = "Koruma: " + vakurValue + " (" + Math.floor(vakurYuzde) + "%) | Rozet: " + blueBadgeCount;
      document.getElementById('vakurFill').style.width = vakurYuzde + "%";
      // Hatip Barı
      if (isHatipUnlocked) {
        document.getElementById('hatipStat').classList.remove("lockedStat");
        let hatipValue = getHatipNufus();
        let hatipYuzde = (hatipValue / 200) * 100;
        document.getElementById('hatipText').innerText = "Nüfus: " + hatipValue + " (" + Math.floor(hatipYuzde) + "%) | Rozet: " + orangeBadgeCount;
        document.getElementById('hatipFill').style.width = hatipYuzde + "%";
      } else {
        document.getElementById('hatipStat').classList.add("lockedStat");
      }
      // Baron Barı
      if (isBaronUnlocked) {
        document.getElementById('baronStat').classList.remove("lockedStat");
        let baronValue = getBaronEtki();
        let baronYuzde = (baronValue / 500) * 100;
        document.getElementById('baronText').innerText = "Etki: " + baronValue + " (" + Math.floor(baronYuzde) + "%) | Rozet: " + redBadgeCount;
        document.getElementById('baronFill').style.width = baronYuzde + "%";
      } else {
        document.getElementById('baronStat').classList.add("lockedStat");
      }
    }

    // Profil bilgisini güncelle (Köy bilgisi)
    function updateProfileInfo() {
      document.getElementById('currentVillageDisplay').innerText = currentVillage;
    }

    // Para UI güncelleme
    function updateMoneyUI() {
      document.getElementById('money').innerText = money;
    }

    // Rozet UI güncelleme
    function updateBadgesUI() {
      document.getElementById('blueBadgeCount').innerText = blueBadgeCount;
      document.getElementById('orangeBadgeCount').innerText = orangeBadgeCount;
      document.getElementById('redBadgeCount').innerText = redBadgeCount;
    }

    // Rütbe seçimi
    function selectRank(rank) {
      if (rank === "Vakur") {
        currentRank = "Vakur";
      } else if (rank === "Hatip") {
        if (!isHatipUnlocked) return;
        currentRank = "Hatip";
      } else if (rank === "Baron") {
        if (!isBaronUnlocked) return;
        currentRank = "Baron";
      }
      showNextTask();
      document.getElementById('taskContainer').classList.add('active');
    }

    // Görev alanını kapatma (Ana menüye dönüş)
    function closeTaskContainer() {
      document.getElementById('taskContainer').classList.remove('active');
    }

    // Görev listesini gösterme – Her rütbe için 5 kademede (her kademe 8 görev)
    function showNextTask() {
      const taskOptionsContainer = document.getElementById('taskOptions');
      taskOptionsContainer.innerHTML = "";
      let taskCount, tierIndex, activeIndex, currentTier, taskList;
      
      if (currentRank === "Vakur") {
        taskCount = vakurTaskCount;
        tierIndex = Math.floor(taskCount / 8);
        activeIndex = taskCount % 8;
        currentTier = tierOrder[tierIndex % tierOrder.length];
        taskList = tasks.vakur[currentTier];
        document.getElementById('rankTitle').innerText = "Vakur Görevleri (" + currentTier + ")";
      } else if (currentRank === "Hatip") {
        taskCount = hatipTaskCount;
        tierIndex = Math.floor(taskCount / 8);
        activeIndex = taskCount % 8;
        currentTier = tierOrder[tierIndex % tierOrder.length];
        taskList = tasks.hatip[currentTier];
        document.getElementById('rankTitle').innerText = "Hatip Görevleri (" + currentTier + ")";
      } else if (currentRank === "Baron") {
        taskCount = baronTaskCount;
        tierIndex = Math.floor(taskCount / 8);
        activeIndex = taskCount % 8;
        currentTier = tierOrder[tierIndex % tierOrder.length];
        taskList = tasks.baron[currentTier];
        document.getElementById('rankTitle').innerText = "Baron Görevleri (" + currentTier + ")";
      }
      
      // Eğer aktif index sıfırlanmışsa (yani önceki kademe tamamlanmışsa):
      if (activeIndex === 0 && taskCount > 0) {
        if (currentTier === "basit") {
          alert("Tebrikler, basit görevleri bitti. Orta görevlere geçtiniz.");
        } else if (currentTier === "orta") {
          alert("Tebrikler, orta görevleri bitti. Zor görevlere geçtiniz.");
        } else if (currentTier === "zor") {
          alert("Tebrikler, zor görevleri bitti. İleri görevlere geçtiniz.");
        } else if (currentTier === "ileri") {
          alert("Tebrikler, ileri görevleri bitti. Son görevlere geçtiniz.");
        } else if (currentTier === "son") {
          // Rütbe terfisi: Vakur için, kullanıcıya terfi etmek yerine tekrar devam etme seçeneği sunuluyor.
          if (currentRank === "Vakur") {
            if (confirm("Tebrikler, Vakur görevlerini tamamladınız!\n\nHatip'e terfi olmak istiyor musunuz? İptal ederseniz, Vakur görevlerine tekrar başlayabilirsiniz.")) {
              isHatipUnlocked = true;
              document.getElementById('cardHatip').classList.remove('locked');
              alert("Hatip oldunuz! Ana menüye dönüyorsunuz.");
              closeTaskContainer();
              return;
            } else {
              // Vakur görevlerine tekrar devam etmek için sayaç sıfırlanıyor.
              vakurTaskCount = 0;
              showNextTask();
              return;
            }
          } else if (currentRank === "Hatip") {
            alert("Tebrikler, baron oldunuz! Ana menüye dönüyorsunuz.");
            isBaronUnlocked = true;
            document.getElementById('cardBaron').classList.remove('locked');
            closeTaskContainer();
            return;
          }
        }
      }
      
      // Görev seçeneklerini listele:
      taskList.forEach((task, index) => {
        const div = document.createElement('div');
        div.classList.add('task-option');
        div.innerText = task;
        if (index < activeIndex) {
          div.classList.add('completed');
        } else if (index === activeIndex) {
          div.classList.add('active');
          div.addEventListener('click', completeActiveTask);
        } else {
          div.classList.add('locked');
        }
        taskOptionsContainer.appendChild(div);
      });
      
      // İlerleme çubuğunu güncelle
      const prog = (activeIndex / 8) * 100;
      document.getElementById('progressBar').style.width = prog + "%";
      document.getElementById('progressText').innerText = Math.floor(prog) + "%";
    }

    // Aktif görevin tamamlanması
    function completeActiveTask() {
      if (currentRank === "Vakur") {
        vakurTaskCount++;
        let rozetKazanc = Math.floor(Math.random() * 3) + 1;
        blueBadgeCount += rozetKazanc;
      } else if (currentRank === "Hatip") {
        hatipTaskCount++;
        let rozetKazanc = Math.floor(Math.random() * 3) + 1;
        orangeBadgeCount += rozetKazanc;
        onur += rozetKazanc;
      } else if (currentRank === "Baron") {
        baronTaskCount++;
        let rozetKazanc = Math.floor(Math.random() * 3) + 1;
        redBadgeCount += rozetKazanc;
        let cashGain = Math.floor(Math.random() * (800 - 300 + 1)) + 300;
        money += cashGain;
        if (blueBadgeCount > 0) {
          blueBadgeCount -= 1;
        }
      }
      
      // Hatip için, 40 görev tamamlandığında Baron kilidi açılıyor.
      if (currentRank === "Hatip" && hatipTaskCount >= 40 && !isBaronUnlocked) {
        isBaronUnlocked = true;
        document.getElementById('cardBaron').classList.remove('locked');
      }
      
      updateStatBars();
      updateBadgesUI();
      updateMoneyUI();
      showNextTask();
    }

    // Seyahat fonksiyonu – her seyahat 500 dolar
    function travelTo(village) {
      if (currentVillage === village) return;
      if (money < 500) {
        alert("Seyahat için yeterli paranız yok!");
        return;
      }
      money -= 500;
      currentVillage = village;
      updateMoneyUI();
      updateProfileInfo();
      alert("Şimdi " + currentVillage + " köyündesin!");
    }

    // MARKET & ENVANTER İşlemleri (değişiklik yok)
    let hasKoy = false, atCount = 0, ucakCount = 0, kumarhaneCount = 0, ceteUyeSayisi = 0;
    function buyItem(itemName, price) {
      if (money < price) return;
      if (!isBaronUnlocked) return;
      money -= price;
      updateMoneyUI();
      switch(itemName) {
        case "Köy":
          if (hasKoy) return;
          hasKoy = true;
          document.getElementById('koyItem').style.display = "none";
          document.getElementById('koyPanelTrigger').style.display = "flex";
          break;
        case "At":
          atCount++; ceteUyeSayisi += 2; break;
        case "Uçak":
          ucakCount++; ceteUyeSayisi += 5; break;
        case "Kumarhane":
          kumarhaneCount++; ceteUyeSayisi += 3; break;
        default: break;
      }
      updateInventoryUI();
    }
    function updateInventoryUI() {
      const inventoryList = document.getElementById('inventoryList');
      inventoryList.innerHTML = "";
      if (hasKoy) {
        const divKoy = document.createElement('div');
        divKoy.innerHTML = `<img src="https://via.placeholder.com/32?text=K%C3%B6y" alt="Köy" /> Köy (1 adet)`;
        inventoryList.appendChild(divKoy);
      }
      if (atCount > 0) {
        const divAt = document.createElement('div');
        divAt.innerHTML = `<img src="https://via.placeholder.com/32?text=%F0%9F%90%8E" alt="At" /> At (x${atCount})`;
        inventoryList.appendChild(divAt);
      }
      if (ucakCount > 0) {
        const divUcak = document.createElement('div');
        divUcak.innerHTML = `<img src="https://via.placeholder.com/32?text=%E2%9C%88%EF%B8%8F" alt="Uçak" /> Uçak (x${ucakCount})`;
        inventoryList.appendChild(divUcak);
      }
      if (kumarhaneCount > 0) {
        const divKumar = document.createElement('div');
        divKumar.innerHTML = `<img src="https://via.placeholder.com/32?text=%24" alt="Kumarhane" /> Kumarhane (x${kumarhaneCount})`;
        inventoryList.appendChild(divKumar);
      }
      if (!hasKoy && atCount === 0 && ucakCount === 0 && kumarhaneCount === 0) {
        inventoryList.innerHTML = "<p>Envanteriniz boş!</p>";
      }
      document.getElementById('ceteUyeSayisi').innerText = ceteUyeSayisi;
    }
    
    // MODAL İşlemleri (aynı kalıyor)
    function toggleKoyPanelModal() {
      updateInventoryUI();
      document.getElementById('koyModal').classList.toggle('active');
    }
    function toggleBadgesModal() {
      document.getElementById('badgesModal').classList.toggle('active');
    }
    function toggleMarketModal() {
      document.getElementById('marketModal').classList.toggle('active');
    }
    function toggleKumarhaneModal() {
      const kumarhaneModal = document.getElementById('kumarhaneModal');
      kumarhaneModal.classList.toggle('active');
      document.getElementById('gambleResult').innerText = "";
      document.getElementById('betAmount').value = "";
    }
    function playGamble() {
      const betInput = document.getElementById('betAmount');
      const gambleResult = document.getElementById('gambleResult');
      const bet = parseInt(betInput.value);
      if (isNaN(bet) || bet <= 0) {
        gambleResult.innerText = "Geçerli bir bahis miktarı giriniz.";
        return;
      }
      if (bet > money) {
        gambleResult.innerText = "Yeterli bakiyeniz yok!";
        return;
      }
      const chance = Math.random();
      if (chance < 0.5) {
        money += bet;
        gambleResult.innerText = `Kazandınız! Yeni bakiye: ${money} $`;
      } else {
        money -= bet;
        gambleResult.innerText = `Kaybettiniz! Yeni bakiye: ${money} $`;
      }
      updateMoneyUI();
    }
    
    /* ------------------------
       4. Sayfa Yüklendiğinde: Stat, Profil vs. Güncelleme
    ------------------------ */
    updateStatBars();
    updateProfileInfo();
    updateMoneyUI();
    updateBadgesUI();
  </script>
</body>
</html>
